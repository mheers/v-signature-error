<template>
  <div class="signature">
    <VPerfectSignature
      :stroke-options="strokeOptions"
      ref="signaturePad"
      class="signaturePad"
      @onEnd="update"
    />
  </div>
</template>

<script lang="ts">
import Vue from 'vue'
import VPerfectSignature, { StrokeOptions } from 'v-perfect-signature'

export default Vue.extend({
  props: {
    value: {
      type: Object,
      default() {
        return {
          data: [
            [
              [103.5, 78.5, 0.5],
              [103.5, 83, 0.5],
              [103, 103, 0.5],
              [99.5, 125.5, 0.5],
              [92.5, 153, 0.5],
              [86, 184.5, 0.5],
              [79, 235, 0.5],
              [77, 264, 0.5],
              [76.5, 284, 0.5],
              [75, 306.5, 0.5],
              [74.5, 318, 0.5],
              [74, 328.5, 0.5],
              [73.5, 338, 0.5],
              [73.5, 351, 0.5],
              [73, 358, 0.5],
              [73, 363.5, 0.5],
              [73, 368, 0.5],
              [72.5, 373, 0.5],
              [72, 376, 0.5],
              [72, 378.5, 0.5],
              [72, 380, 0.5],
              [71.5, 381.5, 0.5],
              [71.5, 382, 0.5],
            ],
            [
              [180, 85, 0.5],
              [179, 86, 0.5],
              [178, 88.5, 0.5],
              [176, 100, 0.5],
              [170, 127.5, 0.5],
              [163, 155, 0.5],
              [154.5, 190.5, 0.5],
              [149.5, 221.5, 0.5],
              [146.5, 254, 0.5],
              [146, 266.5, 0.5],
              [145.5, 277, 0.5],
              [144.5, 287, 0.5],
              [143.5, 292.5, 0.5],
              [142.5, 297.5, 0.5],
              [142.5, 301, 0.5],
              [142.5, 307, 0.5],
              [142.5, 311.5, 0.5],
              [142.5, 315.5, 0.5],
              [142, 318.5, 0.5],
              [141.5, 322.5, 0.5],
              [141, 325.5, 0.5],
              [141, 331, 0.5],
              [141, 337, 0.5],
              [140.5, 343.5, 0.5],
              [140.5, 346, 0.5],
            ],
            [
              [68, 241, 0.5],
              [72, 240.5, 0.5],
              [81.5, 239.5, 0.5],
              [93, 238.5, 0.5],
              [105, 237.5, 0.5],
              [116.5, 236.5, 0.5],
              [131.5, 235, 0.5],
              [139.5, 234, 0.5],
              [146.5, 232, 0.5],
              [156, 227.5, 0.5],
              [163, 223.5, 0.5],
              [168.5, 221, 0.5],
              [170, 220, 0.5],
            ],
            [
              [258, 217, 0.5],
              [257.5, 223, 0.5],
              [257, 227.5, 0.5],
              [256, 241.5, 0.5],
              [253.5, 262.5, 0.5],
              [253, 275.5, 0.5],
              [253, 286, 0.5],
              [253.5, 294.5, 0.5],
              [255, 302, 0.5],
              [255, 306.5, 0.5],
              [255, 311, 0.5],
              [255, 316, 0.5],
              [255, 318, 0.5],
              [255, 319, 0.5],
              [255, 319.5, 0.5],
            ],
            [
              [256.5, 166, 0.5],
              [256, 167, 0.5],
              [253, 170, 0.5],
              [252.5, 172, 0.5],
              [252.5, 173.5, 0.5],
              [252.5, 175.5, 0.5],
              [252.5, 177.5, 0.5],
              [255, 180, 0.5],
              [258.5, 180.5, 0.5],
              [261.5, 180.5, 0.5],
              [265, 180, 0.5],
              [267, 179, 0.5],
              [267.5, 178.5, 0.5],
              [268.5, 176.5, 0.5],
              [269.5, 174.5, 0.5],
              [269.5, 172, 0.5],
              [269.5, 170, 0.5],
              [269, 168.5, 0.5],
              [267.5, 167, 0.5],
              [267.5, 167, 0.5],
              [266.5, 167, 0.5],
              [266, 167, 0.5],
            ],
            [
              [461, 158, 0.5],
              [459.5, 160, 0.5],
              [458, 162.5, 0.5],
              [454.5, 168, 0.5],
              [451.5, 172.5, 0.5],
              [450, 175, 0.5],
              [449, 176.5, 0.5],
              [448.5, 178.5, 0.5],
              [448.5, 179.5, 0.5],
              [449, 179.5, 0.5],
              [451.5, 179.5, 0.5],
              [456, 179, 0.5],
              [459, 177, 0.5],
              [462, 175, 0.5],
              [463.5, 172.5, 0.5],
              [465.5, 169, 0.5],
              [465.5, 166, 0.5],
              [465, 164, 0.5],
              [463.5, 162, 0.5],
              [463, 161.5, 0.5],
            ],
            [
              [541.5, 167, 0.5],
              [540, 168.5, 0.5],
              [538, 170, 0.5],
              [535, 172, 0.5],
              [532.5, 176, 0.5],
              [532, 178.5, 0.5],
              [532, 181, 0.5],
              [534, 184, 0.5],
              [538, 185, 0.5],
              [543, 185.5, 0.5],
              [547.5, 185.5, 0.5],
              [554.5, 185.5, 0.5],
              [556.5, 185.5, 0.5],
              [558, 185.5, 0.5],
              [559, 183, 0.5],
              [558, 173.5, 0.5],
              [555, 167.5, 0.5],
              [551.5, 164.5, 0.5],
              [550, 163, 0.5],
              [548.5, 163, 0.5],
              [547.5, 163, 0.5],
            ],
            [
              [490.5, 229.5, 0.5],
              [490, 232.5, 0.5],
              [489, 240, 0.5],
              [488.5, 243.5, 0.5],
              [488.5, 246.5, 0.5],
              [488.5, 249, 0.5],
              [488.5, 253, 0.5],
              [488.5, 255.5, 0.5],
              [488.5, 257.5, 0.5],
              [488.5, 258.5, 0.5],
              [488.5, 259.5, 0.5],
              [488.5, 260.5, 0.5],
              [488.5, 261.5, 0.5],
              [488.5, 262.5, 0.5],
            ],
            [
              [438, 270.5, 0.5],
              [439.5, 273, 0.5],
              [443.5, 278, 0.5],
              [449, 283.5, 0.5],
              [454.5, 288.5, 0.5],
              [463.5, 294, 0.5],
              [471, 297, 0.5],
              [478, 298.5, 0.5],
              [486.5, 298.5, 0.5],
              [498, 298.5, 0.5],
              [506.5, 297, 0.5],
              [513.5, 295.5, 0.5],
              [524.5, 292, 0.5],
              [531, 291, 0.5],
              [533.5, 290.5, 0.5],
              [534.5, 290.5, 0.5],
            ],
            [
              [478.5, 91.5, 0.5],
              [476, 92, 0.5],
              [472.5, 94, 0.5],
              [461.5, 102.5, 0.5],
              [438.5, 123.5, 0.5],
              [424.5, 141, 0.5],
              [409, 166, 0.5],
              [394.5, 197, 0.5],
              [382, 229.5, 0.5],
              [378.5, 246, 0.5],
              [377, 257, 0.5],
              [377, 274.5, 0.5],
              [378.5, 285, 0.5],
              [380.5, 295, 0.5],
              [383, 303, 0.5],
              [388, 312.5, 0.5],
              [390.5, 316.5, 0.5],
              [394, 320, 0.5],
              [400, 324.5, 0.5],
              [410.5, 330.5, 0.5],
              [418.5, 334, 0.5],
              [426.5, 337, 0.5],
              [433.5, 338.5, 0.5],
              [448, 341.5, 0.5],
              [457.5, 342.5, 0.5],
              [467, 342.5, 0.5],
              [477.5, 341.5, 0.5],
              [494, 338, 0.5],
              [505.5, 335.5, 0.5],
              [514, 333.5, 0.5],
              [523, 331.5, 0.5],
              [533, 328.5, 0.5],
              [539.5, 326.5, 0.5],
              [546, 324.5, 0.5],
              [553.5, 321, 0.5],
              [559, 317.5, 0.5],
              [563.5, 313.5, 0.5],
              [567.5, 308.5, 0.5],
              [571.5, 299, 0.5],
              [573, 292, 0.5],
              [574.5, 285.5, 0.5],
              [576, 279, 0.5],
              [579, 271, 0.5],
              [580.5, 267, 0.5],
              [583, 262.5, 0.5],
              [586.5, 253.5, 0.5],
              [586.5, 248, 0.5],
              [586, 235.5, 0.5],
              [581, 214, 0.5],
              [569, 174, 0.5],
              [562, 155.5, 0.5],
              [556.5, 142.5, 0.5],
              [552, 134, 0.5],
              [545, 124, 0.5],
              [539.5, 119.5, 0.5],
              [531.5, 115, 0.5],
              [519.5, 108.5, 0.5],
              [494, 99, 0.5],
              [479.5, 95, 0.5],
              [469, 91, 0.5],
              [460.5, 87, 0.5],
              [458.5, 85.5, 0.5],
            ],
            [[377.5, 347.5, 0.5]],
          ],
        }
      },
    },
  },
  components: {
    VPerfectSignature,
  },
  data: () => ({
    strokeOptions: {
      size: 16,
      thinning: 0.75,
      smoothing: 0.5,
      streamline: 0.5,
    } as StrokeOptions,
  }),
  watch: {
    value: {
      deep: true,
      handler() {
        this.load()
      },
    },
  },
  mounted() {
    this.load()
  },
  methods: {
    load() {
      if (this.value && this.value.hasOwnProperty('data')) {
        this.fromData(this.value.data)
      }
    },
    toDataURL() {
      return this.$refs.signaturePad.toDataURL()
    },
    toData() {
      return this.$refs.signaturePad.toData()
    },
    fromData(data) {
      console.log(data)
      if (!this.$refs) {
        console.error('ref not available yet')
        return
      }
      this.$refs.signaturePad.fromData(data)
    },
    clear() {
      this.$refs.signaturePad.clear()
      this.update()
    },
    update() {
      const data = this.toData()
      const dataURL = this.toDataURL()
      this.$emit('input', { data, dataURL })
    },
  },
})
</script>

<style scoped>
.signature {
  width: 100%;
  border-bottom: 1px solid gray;
}
.signaturePad {
  width: 100%;
}
</style>
